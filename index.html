<html>
	<style>
		main {
			text-align: center;
			margin-top: 100px;
			font-size: 36pt;
			font-family: sans-serif;
			cursor: pointer;
		}

		ul {
			list-style: none;
			margin: 0;
			margin-top: 50px;
			padding: 0;
			text-align: center;
		}

		li {
			display: inline-block;
			border-radius: 100%;
			background: green;
			height: 50px;
			width: 50px;
			margin: 5px;
		}
	</style>

<body>
	<main></main>
	<script src='http://cdn.ractivejs.org/latest/ractive.js'></script>
	<script id='clock' type='text/html'>
		<div on-click='toggle("run")'>{{ display }}</div>
		<ul>
			{{#each times:t}}
				<li style='{{#if t >= 3}}background: red;{{/if}}'>
			{{/each}}
		</ul>
	</script>

	<script>
		
		const minutesPer = 20;
		const tick = 1000;
		const pad = num => num < 10 ? '0' + num : num;
		
		new Ractive({
			el: 'main',
			template: '#clock',
			data: {
				interval: minutesPer * 60,
			    run: true,
			    times: []
			},
			computed: {
				minutes() { return Math.floor( this.get( 'remaining' ) / 60 ); },
				seconds() { return this.get( 'remaining' ) % 60; },
				display() {
					const minutes = pad( this.get( 'minutes') );
					const seconds = pad( this.get( 'seconds') );
					return  `${minutes}:${seconds}`;
				}
			},
			start() {
				this.set( 'start', new Date() );
				this.push( 'times', this.get( 'times.length' ) + 1 );
				
				const interval = this.get( 'interval' );
				
				this.ticker = setInterval( () => {
					if( this.get('run') ) {
						const elapsed = Math.floor( ( new Date() - this.get( 'start' ) ) / 1000 );
						this.set( 'remaining', interval - elapsed );
					}
				}, tick );
			},
			reset() {
				this.ticker && clearInterval( this.ticker )
			},
			oninit() {
				this.observe( 'remaining', remaining => {
					if( !remaining || remaining < 0 ) {
						if ( this.get( 'times.length' ) ) {
							alert( 'hey' );
						}
						this.start();
					}
					
					// Display remaining time in browser tab
					document.title = this.get('display');
					
				}, { defer: true } );
			}
		})
	</script>

</body>
</html>
