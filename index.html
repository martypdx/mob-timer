<html>
	<style>
		main {
			text-align: center;
			margin-top: 100px;
			font-size: 36pt;
			font-family: sans-serif;
			cursor: pointer;
		}
	</style>

<body>
	<main></main>
	<script src='http://cdn.ractivejs.org/latest/ractive.js'></script>
	<script id='clock' type='text/html'>
		<span on-click='toggle("run")'>{{ display }}</span>
	</script>

	<script>
		function pad ( num ) {
	      return ( num < 10 ? '0' + num : num );
	    }
		var tick = 1000
		var ractive = new Ractive({
			el: 'main',
			template: '#clock',
			data: {
				interval: 20 * 60,
			    run: true
			},
			computed: {
				display: function () {
					return pad(this.get('minutes')) + ':' + pad(this.get('seconds'))
				},
				seconds: '${remaining} % 60',
				minutes: 'Math.floor( ${remaining}/60 )'
			},
			start: function(){
				this.reset();
				this.set( 'start', new Date() );
				var interval = this.get('interval');
				this.ticker = setInterval(function(){
					if(this.get('run')){
						var elapsed = Math.floor( ( new Date() - this.get( 'start' ) ) / 1000 );
						this.set( 'remaining', interval - elapsed );
					}
				}.bind(this), tick)
			},
			reset: function(){
				this.ticker && clearInterval(this.ticker)
			},
			oninit: function(){
				this.observe('remaining', function(n){
					if(!n || n < 0) {
						alert('hey')
						this.start()
					}
					document.title = this.get('display');
				}, { defer: true })
			}
		})
	</script>

</body>
</html>
